<!DOCTYPE html>
<html>
<head>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-4W9HVBX2LB"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-4W9HVBX2LB',{ 'debug_mode': true });
</script>

<title>FundraiseUp</title>
</head>
<body>

<h1>FundraiseUp Test Assignment</h1>

<!-- Fundraise Up: the new standard for online giving -->
<script>(function(w,d,s,n,a)
{if(!w[n])
{var l='call,catch,on,once,set,then,track'
.split(','),i,o=function(n){return'function'==typeof n?o.l.push([arguments])&&o
:function(){return o.l.push([n,arguments])&&o}},t=d.getElementsByTagName(s)[0],
j=d.createElement(s);j.async=!0;j.src='https://cdn.fundraiseup.com/widget/'+a;
t.parentNode.insertBefore(j,t);o.s=Date.now();o.v=4;o.h=w.location.href;o.l=[];
for(i=0;i<7;i++)o[l[i]]=o(l[i]);w[n]=o}
})(window,document,'script','FundraiseUp','AEMZUDUM');</script>
<!-- End Fundraise Up -->

<a href="#XJKDHSTQ" style="display: none"></a>
	
<script>
    // Function to send event to Google Analytics
    function sendGAEvent(eventName, eventParams) {
        console.log('Sending GA event:', eventName, eventParams);
        gtag('event', eventName, eventParams);
    }

    // Detect checkout opened
    const observer = new MutationObserver((mutations) => {
        mutations.forEach((mutation) => {
            if (mutation.type === 'childList') {
                const addedNodes = mutation.addedNodes;
                for (let i = 0; i < addedNodes.length; i++) {
                    if (addedNodes[i].nodeType === Node.ELEMENT_NODE) {
                        const element = addedNodes[i];
                        if (element.id === 'fru-checkout-popup' || element.className.includes('fru-checkout-popup')) {
                            console.log('Checkout opened detected');
                            sendGAEvent('checkout_opened', {
                                'event_category': 'Donation',
                                'event_label': 'Checkout Opened'
                            });
                        }
                    }
                }
            }
        });
    });

    observer.observe(document.body, { childList: true, subtree: true });

    // Listen for custom donation completed event
    window.addEventListener('fundraiseup:donation:completed', function(e) {
        console.log('Donation completed event detected', e.detail);
        sendGAEvent('purchase', {
            'transaction_id': e.detail.donationId || 'unknown',
            'value': e.detail.amount || 0,
            'currency': e.detail.currency || 'USD'
        });
    });

    // Test buttons
    document.body.insertAdjacentHTML('beforeend', `
        <button onclick="testCheckoutOpened()">Simulate Checkout Opened</button>
        <button onclick="testDonationCompleted()">Simulate Donation Completed</button>
    `);

    function testCheckoutOpened() {
        const testElement = document.createElement('div');
        testElement.id = 'fru-checkout-popup';
        document.body.appendChild(testElement);
        setTimeout(() => testElement.remove(), 100);
    }

    function testDonationCompleted() {
        const event = new CustomEvent('fundraiseup:donation:completed', {
            detail: {donationId: '123', amount: 700, currency: 'USD'}
        });
        window.dispatchEvent(event);
    }

    // Additional check to ensure gtag is working
    sendGAEvent('page_view', {
        'event_category': 'Test',
        'event_label': 'Page Loaded'
    });
    </script>



</body>
</html>
